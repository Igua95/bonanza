'use strict';

var mustache = require('mustache');

module.exports = render;

var htmlUnescapes = {
  '&amp;': '&',
  '&lt;': '<',
  '&gt;': '>',
  '&quot;': '"',
  '&#39;': '\'',
  '&#x2F;': '/'
};
var reHtmlUnescapes = /&(?:amp|lt|gt|quot|#39|#x2F);/g;

function render(template, model, encode) {
  if (typeof template === 'function') {
    return template(model, encode);
  }
  else if (typeof template === 'string') {
    if (encode) {
      return mustache.render(template, model);
    }
    else {
      return mustache.render(template, model)
        .replace(reHtmlUnescapes, unescapeHtmlChar);
    }
  }
}

function unescapeHtmlChar(chr) {
  return htmlUnescapes[chr];
}
